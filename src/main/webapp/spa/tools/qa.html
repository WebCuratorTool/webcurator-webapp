<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">

  <title>Target Instance</title>
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="../dist/font/fontawesome-free.min.css">
  <link rel="stylesheet" href="../dist/bootstrap/4.4.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="../dist/adminlte/css/adminlte.min.css">
  <link rel="stylesheet" href="../dist/fancytree/skin-win8/ui.fancytree.min.css">
  <!-- <link rel="stylesheet" href="../dist/fancytree/modules/plain-scrollbar.css"> -->
  <link rel="stylesheet" href="../dist/jquery/menu/jquery.contextMenu.css">
  <link rel="stylesheet" href="../dist/ag-grid/ag-grid.css">
  <link rel="stylesheet" href="../dist/ag-grid/ag-theme-balham.css">
  <link rel="stylesheet" href="../dist/ag-grid/ag-theme-balham-dark.css">
  <link rel="stylesheet" href="qa.css">
</head>
<!--
BODY TAG OPTIONS:
=================
Apply one or more of the following classes to to the body tag
to get the desired effect
|---------------------------------------------------------|
|LAYOUT OPTIONS | sidebar-collapse                        |
|               | sidebar-mini                            |
|---------------------------------------------------------|
-->
<body unselectable="on">

<main class="bd-content" name="content" role="main">
  <div style="position: relative; height: 100vh; width: 100vw;">
    <!-- Networmap Canvas -->
    <div id="network-map-canvas" style="width: 75vw; height: 100vh; outline: none;"></div>

    <!-- Left Button Group -->
    <div class="btn-group" style="position: absolute; left: 3px; top: 5px; z-index: 1000;">
      <button type="button" class="btn btn-default" onclick="networkmap.graph.reload();">Reload</button>
      <button type="button" class="btn btn-default" onclick="networkmap.graph.reset();">Reset</button>
      <button type="button" class="btn btn-default" onclick="networkmap.graph.collapseAll();">Collapse All</button>
      <!-- <button type="button" class="btn btn-default" onclick="hierarchy();"><i class="fab fa-think-peaks"></i> &nbsp; Check URL</button> -->
      <button type="button" class="btn btn-default" onclick="javascript: $('#popup-window-modify-harvest').show();"><i class="fas fa-edit"></i> &nbsp; Modify Harvest</button>
    </div>

    <!-- Right Side card -->
    <div class="bg-default" style="position: absolute; right: 30px; top: 0px; width: calc(25vw - 30px);" id="networkmap-side-container">
      <nav class="main-header navbar navbar-expand" style="margin: 0; height: 50px; border: solid 1px; border-color: #D3D3D3;">
        <h5 id="networkmap-side-title">Domain: root</h5>
      </nav>

      <div class="card-body none-margin-padding" id="side-card-body">
          <div class="networkmap-insight ag-theme-balham" id="networkmap-side-table-group-by-status-code"> </div>
          <div class="networkmap-insight ag-theme-balham hidden" id="networkmap-side-table-group-by-content-type"> </div>
      </div>     <!-- /.card-body -->
    </div> <!-- end of card -->

  </div>

  <div class="popup-window" id="popup-window-loading">
    <div class="spin-overlay"><i class="fas fa-circle-notch text-primary"></i></div>
  </div>
</main>

<div class="bg-dark" style="position: fixed;right: 0; top: 0; width: 30px; height: 100vh; writing-mode: vertical-lr; text-orientation: mixed; line-height: 30px; z-index: 2001;">
  <a href="#" class="btn-side-label bg-black" name="summary" status="on"><span> &nbsp;Summary &nbsp;</span></a> &nbsp;&nbsp;
  <a href="#" class="btn-side-label bg-black btn-side-label-tab" name="statuscode" status="on"><span> &nbsp;StatusCode&nbsp;</span></a>&nbsp;&nbsp;
  <a href="#" class="btn-side-label btn-side-label-tab" name="contenttype" status="off"><span> &nbsp;ContentType&nbsp;</span></a>
</div>

<div class="popup-window"  id="popup-window-modify-harvest">
  <div class="popup-content">
      <div class="row">
        <div class="col-6">
          <nav class="main-header navbar navbar-expand navbar-dark" style="margin: 0;">
              <!-- Left navbar links -->
              <ul class="navbar-nav">
               <!--  <li class="nav-item">
                  <button type="button" class="btn btn-flat btn-primary text-light"><i class="fas fa-search"></i> &nbsp; Query</button>
                </li> -->
                <!-- <li class="nav-divider"></li> -->
                <li class="nav-item">
                  <div class="btn-group">
                    <button type="button" class="btn btn-flat btn-primary text-light dropdown-toggle dropdown-icon" data-toggle="dropdown">
                      Action
                      <span class="sr-only">Toggle Dropdown</span>
                      <div class="dropdown-menu" role="menu">
                        <a class="dropdown-item" href="#"><i class="fas fa-search"></i> &nbsp; Inspect By Query</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#" onclick="gPopupModifyHarvest.loadSeedUrls();"><i class="fas fa-link text-primary"></i> &nbsp;Inspect Starting URLs</a>
                        <a class="dropdown-item" href="#" onclick="gPopupModifyHarvest.loadInvalidUrls();"><i class="fas fa-link text-warning"></i> &nbsp;Inspect Invalid URLs</a>
                        <!-- <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="javascript: hierarchy();"><i class="fab fa-think-peaks"></i> &nbsp; Hierarchy URL</a> -->
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#" onclick="gPopupModifyHarvest.gridCandidate.clearAll();"><i class="far fa-trash-alt"></i> &nbsp; Clear</a>
                      </div>
                    </button>
                  </div>
                </li>
              </ul>
              <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                  <input class="form-control" type="search" placeholder="Filter" aria-label="Search" for="candidateGrid">
                  <input class="form-control hidden" type="search" placeholder="Filter" aria-label="Search" for="candidateTree">
                </li>
              </ul>
          </nav>
          <div class="tab-content">
            <div id="grid-modify-candidate" class="ag-theme-balham grid-modify-harvest"> </div>
            <div id="popup-window-hierarchy" class="card hidden">
              <div class="card-header">
                <h3 class="card-title">Outlinks Tree</h3>
                <div class="card-tools">
                  <button type="button" class="btn btn-tool" data-card-widget="remove" onclick="javascript: $('#popup-window-hierarchy').hide(); $('#grid-modify-candidate').show();"><i class="fas fa-times"></i>
                  </button>
                </div>
                <!-- /.card-tools -->
              </div>
              <!-- /.card-header -->
              <div class="card-body">
                <div class="fixed-size">
                  <table id="hierachy-tree" style="width: 70vw; outline: none;">
                      <colgroup>
                          <col width="50px">
                          <col width="*">
                          <col width="80px">
                          <col width="80px">
                          <col width="80px">
                          <col width="80px">
                          <col width="80px">
                          <col width="80px">
                          <col width="80px">
                      </colgroup>
                      <thead>
                      <tr>
                          <th>Action</th>
                          <th>URL</th>
                          <th>Type</th>
                          <th>Status</th>
                          <th>Size</th>
                          <th>URLs</th>
                          <th>Success</th>
                          <th>Failed</th>
                          <th>TotSize</th>
                      </tr>
                      </thead>
                  </table>
                </div>
              </div>
              <!-- /.card-body -->
            </div>
            <!-- /.card -->
          </div>
        </div>
        <div class="col-6">
          <nav class="main-header navbar navbar-expand navbar-dark" style="margin: 0;">
              <!-- Left navbar links -->
              <ul class="navbar-nav">
                <li class="nav-item">
                  <div class="btn-group btn-primary btn-nav-tab" for="prune" id="tab-btn-prune">
                    <button type="button" class="btn btn-flat text-light">To Be Pruned</button>
                  </div>
                </li>
                <li class="nav-divider"></li>
                <li class="nav-item">
                  <div class="btn-group btn-outline-primary btn-nav-tab" for="import" id="tab-btn-import">
                    <button type="button" class="btn btn-flat text-light">To Be Imported</button>
                    <button type="button" class="btn btn-flat text-light dropdown-toggle dropdown-icon" data-toggle="dropdown">
                      <span class="sr-only">Toggle Dropdown</span>
                      <div class="dropdown-menu" role="menu">
                        <a class="dropdown-item" href="#">New Import</a>
                        <a class="dropdown-item" href="#">Bulk Import</a>
                      </div>
                    </button>
                  </div>
                </li>
              </ul>
              <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                <input class="form-control" type="search" placeholder="Filter" aria-label="Search" for="prune">
                <input class="form-control hidden" type="search" placeholder="Filter" aria-label="Search" for="import">
                </li>
              </ul>
          </nav>
          <div class="tab-content" id="grid-tobe-modified">
            <div id="grid-modify-prune" class="ag-theme-balham grid-modify-harvest"> </div>
            <div id="grid-modify-import" class="ag-theme-balham grid-modify-harvest hidden"> </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-11" style="padding: 10px 10px 0px 10px;">
            <textarea class="form-control" rows="4" placeholder="Provenance Note ..." style="resize: none;"></textarea>
        </div>
        <div class="col-1">
          <div style="width: 90px; margin: 0; position: absolute; top: 50%; left: 5px; -ms-transform: translateY(-50%); transform: translateY(-50%);">
            <button type="button" class="btn btn-block btn-primary" onclick="applyRecrawl();">Apply</button>
            <br>
            <button type="button" class="btn btn-block btn-secondary" onclick="$('#popup-window-modify-harvest').hide();">Close</button>
          </div>
        </div>
      </div>
    </div>
</div>

<!-- Popup Hop Path-->
<div class="popup-window" id="popup-window-hop-path">
<div class="card card-primary popup-content">
  <div class="card-header">
    <h3 class="card-title">Hop Path</h3>

    <div class="card-tools">
      <button type="button" class="btn btn-tool" onclick="$('#popup-window-hop-path').hide();"><i class="fas fa-times"></i>
      </button>
    </div>
    <!-- /.card-tools -->
  </div>
  <!-- /.card-header -->
  <div class="card-body none-margin-padding"  id="hoppath-canvas" style="background: white; height: calc(100% - 50px);">
  </div>   <!-- /.card-body -->
</div> <!-- /.card -->
</div>

<!-- Popup Import Input-->
<div class="popup-window" id="popup-window-import-input">
<div class="card card-primary popup-content">
  <div class="card-header">
    <h3 class="card-title">Re-crawl Content For URL</h3>
    <div class="card-tools">
      <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-times"></i></button>
    </div>
    <!-- /.card-tools -->
  </div>
  <!-- /.card-header -->
    <!-- <form role="form" id="importform" action="javascript: uploadRecrawlFiles();" method="post" enctype="multipart/form-data"> -->
    <form role="form">
        <div class="card-body" style="height: 35vh;">
              <div class="form-group">
                <label for="specifyTargetUrlInput">Specify Target URL</label>
                <input type="input" class="form-control" id="specifyTargetUrlInput" placeholder="Specify Target URL">
              </div>

              <div class="form-group">
                <!-- <label for="importFromFileInput">Import from disk file</label> -->
                <div class="custom-control custom-radio">
                  <input class="custom-control-input" type="radio" id="customRadio1" name="customRadio" flag="File" checked>
                  <label for="customRadio1" class="custom-control-label">Option 1: Re-crawl from disk file</label>
                </div>
                <div class="input-group">
                  <div class="custom-file">
                    <input type="file" class="custom-file-input" id="sourceFile" name="sourceFile">
                    <label class="custom-file-label" for="sourceFile" id="label-source-file">Choose file</label>
                  </div>
                  <div class="input-group-append">
                    <!-- <span class="input-group-text" id="">Upload</span> -->
                    <!-- <input type="submit" value="import" id="submit"/> -->
                  </div>
                </div>
                <br/>
                <!-- <label for="importFromUrlInput">Import from URL</label> -->
                <div class="custom-control custom-radio">
                  <input class="custom-control-input" type="radio" id="customRadio2" name="customRadio" flag="URL">
                  <label for="customRadio2" class="custom-control-label">Option 2: Re-crawl from URL</label>
                </div>
                <div class="input-group">
                  <input type="input" class="form-control" id="importFromUrlInput" placeholder="Source URL">
                  <div class="input-group-append">
                    <span class="input-group-text" onclick="useTargetURL();">Use Target URL</span>
                  </div>
                </div>
              </div>
        </div>  <!-- /.card-body -->
    </form>

  <div class="card-footer" style="width: 100%; position: absolute; bottom: 0;">
    <div class="row">
      <div class="col-8">
        <div class="custom-control custom-checkbox">
          <input class="custom-control-input" type="checkbox" id="checkbox-prune-of-recrawle" checked>
          <label for="checkbox-prune-of-recrawle" class="custom-control-label">Prune the existing content when exist</label>
        </div>
      </div>
      <div class="col-2">
          <!-- <button type="button" class="btn btn-block btn-primary" onclick="spPrunedImported($('#tab-btn-import'));">Import</button> -->
          <button type="button" class="btn btn-block btn-primary" onclick="gPopupModifyHarvest.processorImport.insertRecrawlItem();">Re-crawl</button>
          <!-- <input type="submit" value="Re-crawl" class="btn btn-block btn-primary" id="submit"/> -->
      </div>
      <div class="col-2">
          <button type="button" class="btn btn-block btn-secondary" onclick="$('#popup-window-import-input').hide();">Close</button>
      </div>
    </div>
  </div>

</div> <!-- /.card -->
</div>


<script src="../dist/jquery/jquery-3.4.1.min.js"></script>
<!-- <script src="../dist/jquery/require.js"></script> -->
<script src="../dist/bootstrap/bootstrap.bundle.min.js"></script>
<script src="../dist/plugins/bs-custom-file-input.min.js"></script>
<script src="../dist/adminlte/js/adminlte.js"></script>
<script src="../dist/vis/vis-network.js"></script>
<script src="../dist/fancytree/jquery.fancytree-all-deps.min.js"></script>
<script src="../dist/fancytree/modules/jquery.fancytree.table.js"></script>
<script src="../dist/fancytree/modules/jquery.fancytree.wide.js"></script>
<!-- <script src="../dist/fancytree/modules/jquery.fancytree.filter.js"></script> -->
<!-- <script src="../dist/fancytree/modules/plain-scrollbar.js"></script> -->
<script src="../dist/fancytree/modules/jquery.fancytree.logger.js"></script>
<!-- <script src="../dist/chartjs/Chart.js"></script> -->
<script src="../dist/jquery/menu/jquery.contextMenu.js"></script>
<script src="../dist/jquery/menu/jquery.ui.position.js"></script>
<script src="../dist/ag-grid/ag-grid-community.js"></script>
<!-- <script src="../dist/google/loader.js"></script> -->
<script src="../dist/d3/d3.js"></script>
<script src="networkmap-graph.js"></script>
<script src="networkmap-grid.js"></script>
<script src="networkmap-menumap.js"></script>
<!-- <script src="networkmap-sunburst.js"></script> -->
<script src="networkmap.js"></script>
<script src="popup-modify-harvest-import.js"></script>
<script src="popup-modify-harvest.js"></script>
<script src="popup-hop-path.js"></script>

<script src="qa.js"></script>

<script>
    // $('#popup-window-loading').show();
    var urlParameters=getUrlVars();
    var jobId=parseInt(urlParameters["targetInstanceOid"]);
    var harvestResultNumber=parseInt(urlParameters["harvestNumber"]);

    var visHopPath=new HopPath('hoppath-canvas', jobId, harvestResultNumber);
    var networkmap=new NetworkMap();
    var gPopupModifyHarvest=new PopupModifyHarvest(jobId, harvestResultNumber);
    // var hierarchyTree=new HierarchyTree("#hierachy-tree", jobId, harvestResultNumber);
    
    $(function(){
        bsCustomFileInput.init();

        // document.addEventListener('contextmenu', event => event.preventDefault());
        sp("networkmap");
        
        networkmap.init(jobId, harvestResultNumber);
        // hierarchyTree.draw();

        $("input[name=search]").on("change search", function(e){
          var n,
            tree = $.ui.fancytree.getTree(),
            match = $.trim($(this).val());

          // Pass a string to perform case insensitive matching
          n = tree.filterNodes(match, { mode: "hide" });
          $("span.matches").text(n ? "(" + n + " matches)" : "");
        });

        $(".btn-side-label").on("click", function(e){
          var name=$(this).attr('name');          
          if(name==='summary'){
            var status=$(this).attr('status');
            if(status==='on'){
              $(this).attr('status', 'off');
              $(this).removeClass('bg-black');
              $('#network-map-canvas').width('calc(100vw - 30px)');
              $('#networkmap-side-container').hide();
            }else{
              $(this).attr('status', 'on');
              $(this).addClass('bg-black');
              $('#network-map-canvas').width('75vw');
              $('#networkmap-side-container').show();
            }
          }else{
            $('.btn-side-label-tab').removeClass('bg-black');
            $(this).addClass('bg-black');
            if(name==='statuscode'){
              $(".networkmap-insight").hide();
              $("#networkmap-side-table-group-by-status-code").show();
            }else if(name==='contenttype'){
              $(".networkmap-insight").hide();
              $("#networkmap-side-table-group-by-content-type").show();
            }
          }
        });

        $(".btn-nav-tab").on("click", function(e){
          $(".btn-nav-tab").removeClass("btn-primary");
          $(".btn-nav-tab").addClass("btn-outline-primary");
          $(this).removeClass("btn-outline-primary");
          $(this).addClass("btn-primary");

          var tab=$(this).attr("for");
          $("#grid-tobe-modified .grid-modify-harvest").hide();
          $("#grid-modify-"+tab).show();
        });

        // Search input filter
        $("#popup-window-modify-harvest input[type='search']").on('input', function(e){
          var key=$(this).attr('for');
          var val=$(this).val();
          var target;
          if(key==='prune'){
            target=gPopupModifyHarvest.gridPrune;
          }else if(key==='import'){
            target=gPopupModifyHarvest.gridImport;
          }else if(key==='candidateGrid'){
            target=gPopupModifyHarvest.gridCandidate;
          }else if(key==='candidateTree'){
            target=gPopupModifyHarvest.hierarchyTree;
          }
          target.filter(val);
        });
    });

    function hierarchy(){
      $('#popup-window-hierarchy').show();
    }

    function spHierarchy(){
      if($('#checkbox-tree-view').prop('checked')===true){
        $('#grid-modify-candidate').hide();
        $('#hierachy-tree').show();
      }else{
        $('#hierachy-tree').hide();
        $('#grid-modify-candidate').show();
      }
    }

    function useTargetURL(){
      var url=$("#specifyTargetUrlInput").val();
      $('#importFromUrlInput').val(url);
    }
</script>
</body>