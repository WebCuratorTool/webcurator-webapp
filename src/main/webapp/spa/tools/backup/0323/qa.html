<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">

  <title>Target Instance</title>
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="../dist/font/fontawesome-free.min.css">
  <link rel="stylesheet" href="../dist/bootstrap/4.4.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="../dist/adminlte/css/adminlte.min.css">
  <link rel="stylesheet" href="../dist/fancytree/skin-win8/ui.fancytree.min.css">
  <link rel="stylesheet" href="../dist/fancytree/modules/plain-scrollbar.css">
  <link rel="stylesheet" href="../dist/jquery/menu/jquery.contextMenu.css">
  <link rel="stylesheet" href="../dist/ag-grid/ag-grid.css">
  <link rel="stylesheet" href="../dist/ag-grid/ag-theme-balham.css">
  <link rel="stylesheet" href="../dist/ag-grid/ag-theme-balham-dark.css">
  <link rel="stylesheet" href="qa.css">
</head>
<!--
BODY TAG OPTIONS:
=================
Apply one or more of the following classes to to the body tag
to get the desired effect
|---------------------------------------------------------|
|LAYOUT OPTIONS | sidebar-collapse                        |
|               | sidebar-mini                            |
|---------------------------------------------------------|
-->
<body unselectable="on">

<main class="bd-content" name="content" role="main">
  <div style="position: relative; height: 100vh; width: 100vw;">
    <!-- Networmap Canvas -->
    <div id="network-map-canvas" style="width: 80vw;"></div>

    <!-- Left Button Group -->
    <div class="btn-group" style="position: absolute; left: 3px; top: 5px; z-index: 1000;">
      <button type="button" class="btn btn-default" onclick="networkmap.graph.reload();">Reload</button>
      <button type="button" class="btn btn-default" onclick="networkmap.graph.reset();">Reset</button>
      <button type="button" class="btn btn-default" onclick="networkmap.graph.collapseAll();">Collapse All</button>
      <button type="button" class="btn btn-default" onclick="hierarchy();"><i class="fab fa-think-peaks"></i> &nbsp; URL Hierarchy</button>
      <button type="button" class="btn btn-default" onclick="modifyHarvest();"><i class="fas fa-edit"></i> &nbsp; Modify Harvest</button>
    
      <h3 class="card-title" id="networkmap-side-title" style="margin-left: 50px; line-height: 40px; width: 45vw;">Domain: Root</h3>
    </div>

    <!-- Right Side card -->
    <div class="bg-default" style="position: absolute; right: 22px; top: 0px; width: calc(20vw - 22px);" id="networkmap-side-container">
       <nav class="main-header navbar navbar-expand navbar-info navbar-dark" style="margin: 0;">
          <!-- Left navbar links -->
          <ul class="navbar-nav">
            <li class="nav-item"><a class="nav-link" href="javascript: networkmap.reset();"><i class="fas fa-bars"></i></a></li>
          </ul>
          <ul class="navbar-nav ml-auto">
            <li class="nav-item"><a class="nav-link" href="javascript: spNetworkMapSideTab('networkmap-side-chart-type');"><i class="fas fa-grip-vertical"></i> Type</a></li>
            <li class="nav-item"><a class="nav-link" href="javascript: spNetworkMapSideTab('networkmap-side-chart-error');"><i class="fas fa-grip-vertical"></i> Error</a></li>
            <li class="nav-item"><a class="nav-link" href="javascript: spNetworkMapSideTab('networkmap-side-table');"><i class="fas fa-list-alt"></i> Grid</a></li>
          </ul>
        </nav>
      <div class="card-body none-margin-padding" id="side-card-body">
          <div class="networkmap-insight" id="networkmap-side-chart-type" style=" overflow-y: auto;"></div>
          <div class="networkmap-insight" id="networkmap-side-chart-error" style="  overflow-y: auto;"></div>
          <div class="networkmap-insight ag-theme-balham" id="networkmap-side-table"> </div>
      </div>     <!-- /.card-body -->
    </div> <!-- end of card -->

  </div>

  <div class="popup-window-opacity" id="popup-window-loading">
    <div class="spin-overlay"><i class="fas fa-circle-notch text-primary"></i></div>
  </div>
</main>

<div class="bg-dark" style="position: fixed; right: 0; top: 0; width: 22px; height: 100vh; z-index: 1001; writing-mode: vertical-lr; text-orientation: mixed; line-height: 22px;">
  <a href="javascript:toggleNetworkMapGrid();"><span class="text-info"> &nbsp;Summary</span></a>
</div>

<div class="popup-window"  id="popup-window-modify-harvest">
  <div class="popup-window-content">
      <div class="row">
        <div class="col-6">
          <!-- <div id="grid-modify-prune-left" class="ag-theme-balham window-modify-grid"> </div> -->
          <div class="card">
            <div class="card-header p-2 bg-dark">
              <ul class="nav nav-pills">
                <li class="nav-item"><a class="nav-link">Candidates:</a></li>
                <li class="nav-item"><button type="button" class="btn btn-block btn-primary">Query</button></li>
                <li class="nav-item" style="position: absolute; right: 10px;">
                    <input class="form-control" type="search" placeholder="Filter" aria-label="Search">
                </li>
              </ul>
            </div><!-- /.card-header -->
            <div class="card-body none-margin-padding">
              <div id="grid-modify-candidate" class="ag-theme-balham window-modify-grid"> </div>
            </div>
          </div>   <!-- end of card -->
        </div>

        <div class="col-6">
          <!-- <div id="grid-modify-prune-right" class="ag-theme-balham window-modify-grid"> </div> -->
          <div class="card">
            <div class="card-header p-2 bg-dark">
              <ul class="nav nav-pills">
                <li class="nav-item"><a class="nav-link active" href="#card-tab-prune" data-toggle="tab">To Be Pruned</a></li>
                <li class="nav-item"><a class="nav-link" href="#card-tab-import" data-toggle="tab">To Be Imported</a></li>
                <li class="nav-item" style="position: absolute; right: 10px;">
                    <input class="form-control" type="search" placeholder="Filter" aria-label="Search">
                </li>
              </ul>
            </div><!-- /.card-header -->
            <div class="card-body none-margin-padding">
              <div class="tab-content">
                <div class="active tab-pane" id="card-tab-prune">
                    <div id="grid-modify-prune" class="ag-theme-balham window-modify-grid"> </div>
                </div>
                <div class="tab-pane" id="card-tab-import">
                    <div id="grid-modify-import" class="ag-theme-balham window-modify-grid"> </div>
                </div>
              </div>
            </div>   <!-- end of body -->
          </div>   <!-- end of card -->
        </div>   <!-- end of col -->
     </div>  <!-- end of row -->
    
     <div class="row">
        <div class="col-11" style="padding-left: 10px;">
            <textarea class="form-control" rows="4" placeholder="Provenance Note ..." style="resize: none;"></textarea>
        </div>
        <div class="col-1">
          <div style="width: 100px; margin: 0; position: absolute; top: 50%; left: 5px; -ms-transform: translateY(-50%); transform: translateY(-50%);">
            <button type="button" class="btn btn-block btn-primary">Apply</button>
            <br>
            <button type="button" class="btn btn-block btn-secondary" onclick="$('#popup-window-modify-harvest').hide();">Close</button>
          </div>
        </div>
     </div>
  </div>
</div>


<!-- Popup Hop Path-->
<div class="card card-primary" id="popup-window-hop-path">
  <div class="card-header">
    <h3 class="card-title">Hop Path</h3>

    <div class="card-tools">
      <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-times"></i>
      </button>
    </div>
    <!-- /.card-tools -->
  </div>
  <!-- /.card-header -->
  <div class="card-body none-margin-padding" style="height: 85vh;">
      <div id="hoppath-canvas"></div>
  </div>   <!-- /.card-body -->
</div> <!-- /.card -->


<!-- Popup Import Input-->
<div class="card card-primary"  id="popup-window-import-input">
  <div class="card-header">
    <h3 class="card-title">Import Content For URL</h3>
    <div class="card-tools">
      <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-times"></i></button>
    </div>
    <!-- /.card-tools -->
  </div>
  <!-- /.card-header -->
  <div class="card-body" style="height: 35vh;">
    <form role="form">
        <div class="form-group">
          <label for="specifyTargetUrlInput">Specify Target URL</label>
          <input type="input" class="form-control" id="specifyTargetUrlInput" placeholder="Specify Target URL">
        </div>

        <div class="form-group">
          <!-- <label for="importFromFileInput">Import from disk file</label> -->
          <div class="custom-control custom-radio">
            <input class="custom-control-input" type="radio" id="customRadio1" name="customRadio" checked>
            <label for="customRadio1" class="custom-control-label">Option 1: Import from disk file</label>
          </div>
          <div class="input-group">
            <div class="custom-file">
              <input type="file" class="custom-file-input" id="importFromFileInput">
              <label class="custom-file-label" for="importFromFileInput">Choose file</label>
            </div>
            <div class="input-group-append">
              <span class="input-group-text" id="">Upload</span>
            </div>
          </div>
    
          <!-- <label for="importFromUrlInput">Import from URL</label> -->
          <div class="custom-control custom-radio">
            <input class="custom-control-input" type="radio" id="customRadio2" name="customRadio">
            <label for="customRadio2" class="custom-control-label">Option 2: Import from URL</label>
          </div>
          <div class="input-group">
            <input type="input" class="form-control" id="importFromUrlInput" placeholder="Source URL">
            <div class="input-group-append">
              <span class="input-group-text" id="">Download</span>
            </div>
          </div>
        </div>
    </form>
  </div>  <!-- /.card-body -->

  <div class="card-footer" style="width: 100%; position: absolute; bottom: 0;">
    <div class="row">
      <div class="col-8"></div>
      <div class="col-2">
          <button type="button" class="btn btn-block btn-primary">Import</button>
      </div>
      <div class="col-2">
          <button type="button" class="btn btn-block btn-secondary" onclick="$('#popup-window-import-input').hide();">Close</button>
      </div>
    </div>
  </div>
</div> <!-- /.card -->


<!-- Popup Hierarchy-->
<div class="card card-primary" id="popup-window-hierarchy">
  <div class="card-header">
    <h3 class="card-title">Hierarchy</h3>
    <div class="card-tools">
      <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-times"></i></button>
    </div>    <!-- /.card-tools -->
  </div>   <!-- /.card-header -->
  <div class="card-body none-margin-padding">
    <div class="fancytree-grid-container flexbox-item-grow">
        <table id="hierachy-tree">
            <colgroup>
                <col width="50px">
                <col width="*">
                <col width="80px">
                <col width="80px">
                <col width="80px">
                <col width="80px">
                <col width="80px">
                <col width="80px">
                <col width="80px">
            </colgroup>
            <thead>
            <tr>
                <th>Action</th>
                <th>Title</th>
                <th>Type</th>
                <th>Status</th>
                <th>Size</th>
                <th>URLs</th>
                <th>Success</th>
                <th>Failed</th>
                <th>TotSize</th>
            </tr>
            </thead>
        </table>
        <div id="verticalScrollbar" style="top:50px; height:calc(100% - 60px);"></div>
    </div>
  </div>   <!-- /.card-body -->
</div> <!-- /.card -->

<script src="../dist/jquery/jquery-3.4.1.min.js"></script>
<!-- <script src="../dist/jquery/require.js"></script> -->
<script src="../dist/bootstrap/bootstrap.bundle.min.js"></script>
<script src="../dist/adminlte/js/adminlte.js"></script>
<script src="../dist/vis/vis-network.js"></script>
<script src="../dist/fancytree/jquery.fancytree-all-deps.min.js"></script>
<script src="../dist/fancytree/modules/jquery.fancytree.grid.js"></script>
<script src="../dist/fancytree/modules/jquery.fancytree.filter.js"></script>
<script src="../dist/fancytree/modules/plain-scrollbar.js"></script>
<script src="../dist/fancytree/modules/jquery.fancytree.logger.js"></script>
<!-- <script src="../dist/chartjs/Chart.js"></script> -->
<script src="../dist/jquery/menu/jquery.contextMenu.js"></script>
<script src="../dist/jquery/menu/jquery.ui.position.js"></script>
<script src="../dist/ag-grid/ag-grid-community.js"></script>
<!-- <script src="../dist/google/loader.js"></script> -->
<script src="../dist/d3/d3.js"></script>
<script src="networkmap-graph.js"></script>
<script src="networkmap-grid.js"></script>
<script src="networkmap-menumap.js"></script>
<!-- <script src="networkmap-sunburst.js"></script> -->
<script src="networkmap.js"></script>
<script src="popup-modify-harvest.js"></script>
<script src="popup-hierarchy-tree.js"></script>

<script src="qa.js"></script>

<script>
    // $('#popup-window-loading').show();

    var urlParameters=getUrlVars();
    var jobId=parseInt(urlParameters["targetInstanceOid"]);
    var harvestResultNumber=parseInt(urlParameters["harvestNumber"]);

    var visHopPath, networkmap, gPopupModifyHarvest, gTreeMap;
    // var treeMap=new NetworkMapTreeMap('networkmap-insight-sunburst', '', 'totSize');
    var hierarchyTree;
    $(function(){
        document.addEventListener('contextmenu', event => event.preventDefault());
        // $('.popup-modal').on('click', function(){
        //   $(this).hide();
        // });

        sp("networkmap");
        
        gPopupModifyHarvest=new PopupModifyHarvest(jobId, harvestResultNumber);

        networkmap=new NetworkMap();
        networkmap.init(jobId, harvestResultNumber);

        $("input[name=search]").on("change search", function(e){
          var n,
            tree = $.ui.fancytree.getTree(),
            match = $.trim($(this).val());

          // Pass a string to perform case insensitive matching
          n = tree.filterNodes(match, { mode: "hide" });
          $("span.matches").text(n ? "(" + n + " matches)" : "");
        });

        // $(".main-nav-link").click(function(event){
        //   var id=$(this).attr('id');
        //   sp(id);
        // });

        hierarchyTree=new HierarchyTree("#hierachy-tree", jobId, harvestResultNumber);
        hierarchyTree.draw();

    });


    function modifyHarvest(){
      var node=networkmap.graph.getSelectedNode();
      if(node){
        gPopupModifyHarvest.addPruneUrlsViaDomain(node);
      }else{
        $('#popup-window-modify-harvest').show();
      }
    }

    function hierarchy(){
      $('#popup-window-hierarchy').show();
    }
</script>
</body>