<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">

  <title>Target Instance</title>

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="../dist/font/fontawesome-free.min.css">
  <link rel="stylesheet" href="../dist/bootstrap/4.4.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="../dist/adminlte/css/adminlte.min.css">
  <link rel="stylesheet" href="../dist/fancytree/skin-win8/ui.fancytree.min.css">
  <link rel="stylesheet" href="../dist/fancytree/modules/plain-scrollbar.css">
  <!-- <link rel="stylesheet" href="../dist/jquery/menu/jquery.contextMenu.css"> -->
  <link rel="stylesheet" href="../dist/ag-grid/ag-grid.css">
  <link rel="stylesheet" href="../dist/ag-grid/ag-theme-balham.css">
  <link rel="stylesheet" href="../dist/ag-grid/ag-theme-balham-dark.css">
  <link rel="stylesheet" href="qa.css">
</head>
<!--
BODY TAG OPTIONS:
=================
Apply one or more of the following classes to to the body tag
to get the desired effect
|---------------------------------------------------------|
|LAYOUT OPTIONS | sidebar-collapse                        |
|               | sidebar-mini                            |
|---------------------------------------------------------|
-->
<body>
<header class="navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar">
<div class="navbar-nav-scroll">
    <ul class="navbar-nav bd-navbar-nav flex-row" id="main-navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="/curator/target/queue.html">Home</a>
      </li>
      <li class="nav-item">
        <a class="nav-link main-nav-link active" href="#" id="networkmap">NetworkMap</a>
      </li>
      <li class="nav-item">
        <a class="nav-link main-nav-link" href="#" id="urls">Links</a>
      </li>
      <li class="nav-item">
        <a class="nav-link main-nav-link" href="#" id="hoppath">HopPath</a>
      </li>
      <li class="nav-item">
        <a class="nav-link main-nav-link" href="#" id="hierachy">Hierachy</a>
      </li>
      <li class="nav-item dropdown">
      <a class="nav-item nav-link dropdown-toggle mr-md-2" href="#" id="bd-versions" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        More
      </a>
      <div class="dropdown-menu dropdown-menu-md-right" aria-labelledby="bd-versions">
        <a class="dropdown-item" href="/docs/4.4/"><i class="nav-icon fas fa-calendar-alt"></i> &nbsp;History</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item" href="https://getbootstrap.com/docs/4.3/"><i class="nav-icon fas fa-tag"></i> &nbsp;Log1</a>
        <a class="dropdown-item" href="https://getbootstrap.com/docs/4.2/"><i class="nav-icon fas fa-tag"></i> &nbsp;Log2</a>
        <a class="dropdown-item" href="https://getbootstrap.com/docs/4.0/"><i class="nav-icon fas fa-tag"></i> &nbsp;Log3</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item" href=""><i class="nav-icon fas fa-at"></i> &nbsp;Live</a>
        <a class="dropdown-item" href=""><i class="nav-icon fas fa-at"></i> &nbsp;Wayback</a>
        <a class="dropdown-item" href="https://getbootstrap.com/docs/4.0/"><i class="nav-icon fas fa-hammer"></i> &nbsp;Configuration</a>
      </div>
    </li>
    </ul>
  </div>
      
  <!-- Networkmap Nav-->
  <ul class="navbar-nav ml-md-auto subnav" id="navbar-nav-networkmap">
    <li class="nav-item">
      <a class="nav-link" href="#" onclick="javascript:toggleLayoutCol();"><i class="fas fa-bars"></i></a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#" onclick="javascript:$.ui.fancytree.getTree('#domain-tree').expandAll();">Expand All</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#" onclick="javascript:$.ui.fancytree.getTree('#domain-tree').expandAll(false);">Collapse All</a>
    </li>
  </ul>

  <!-- URLs Nav -->
  <ul class="navbar-nav ml-md-auto subnav" id="navbar-nav-urls">
    <li class="nav-item">
      <a class="nav-link" href="#" onclick="javascript:$.ui.fancytree.getTree('#domain-grid-container').expandAll(false);">Search</a>
    </li>

    <li class="nav-item dropdown">
      <a class="nav-item nav-link dropdown-toggle mr-md-2" href="#" id="bd-versions" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        Action
      </a>
      <div class="dropdown-menu dropdown-menu-md-right" aria-labelledby="bd-versions">
        <a class="dropdown-item" href="/docs/4.4/">Search</a>
        <a class="dropdown-item" href="https://getbootstrap.com/docs/4.3/">View</a>
        <a class="dropdown-item" href="javascript:drawHopPathFromSelectedURLs();">Hop path</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item" href="https://getbootstrap.com/docs/4.0/">Prune Selected</a>
        <a class="dropdown-item" href="https://v4-alpha.getbootstrap.com/">Import from disk file</a>
        <a class="dropdown-item" href="https://getbootstrap.com/docs/3.4/">Import from URL</a>
        <a class="dropdown-item" href="https://getbootstrap.com/docs/3.3/">Automated QA Imports</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item" href="/docs/versions/">Provenance Note</a>
      </div>
    </li>
    <li class="nav-item">
      <a class="nav-link text-light" href="#" onclick="javascript:$.ui.fancytree.getTree('#domain-grid-container').expandAll(false);">Apply</a>
    </li>
  </ul>

  <!-- Hop path Nav -->
  <ul class="navbar-nav ml-md-auto subnav" id="navbar-nav-hoppath">
    <li class="nav-item">
      <a class="nav-link" href="#" onclick="javascript:$.ui.fancytree.getTree('#domain-grid-container').expandAll(false);">Search</a>
    </li>

    <li class="nav-item dropdown">
      <a class="nav-item nav-link dropdown-toggle mr-md-2" href="#" id="bd-versions" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        Action
      </a>
      <div class="dropdown-menu dropdown-menu-md-right" aria-labelledby="bd-versions">
        <a class="dropdown-item" href="/docs/4.4/">Search</a>
        <a class="dropdown-item" href="https://getbootstrap.com/docs/4.3/">View</a>
        <a class="dropdown-item" href="https://getbootstrap.com/docs/4.2/">Hop path</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item" href="https://getbootstrap.com/docs/4.0/">Prune Selected</a>
        <a class="dropdown-item" href="https://v4-alpha.getbootstrap.com/">Import from disk file</a>
        <a class="dropdown-item" href="https://getbootstrap.com/docs/3.4/">Import from URL</a>
        <a class="dropdown-item" href="https://getbootstrap.com/docs/3.3/">Automated QA Imports</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item" href="/docs/versions/">Provenance Note</a>
      </div>
    </li>
    <li class="nav-item">
      <a class="nav-link text-light" href="#" onclick="javascript:$.ui.fancytree.getTree('#domain-grid-container').expandAll(false);">Apply</a>
    </li>
  </ul>

  <!-- Hierachy Nav -->
  <ul class="navbar-nav ml-md-auto subnav" id="navbar-nav-hierachy">
    <li class="nav-item">
      <a class="nav-link" href="#" onclick="javascript:$.ui.fancytree.getTree('#domain-grid-container').expandAll(false);">Search</a>
    </li>

    <li class="nav-item dropdown">
      <a class="nav-item nav-link dropdown-toggle mr-md-2" href="#" id="bd-versions" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        Action
      </a>
      <div class="dropdown-menu dropdown-menu-md-right" aria-labelledby="bd-versions">
        <a class="dropdown-item" href="/docs/4.4/">Search</a>
        <a class="dropdown-item" href="https://getbootstrap.com/docs/4.3/">View</a>
        <a class="dropdown-item" href="https://getbootstrap.com/docs/4.2/">Hop path</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item" href="https://getbootstrap.com/docs/4.0/">Prune Selected</a>
        <a class="dropdown-item" href="https://v4-alpha.getbootstrap.com/">Import from disk file</a>
        <a class="dropdown-item" href="https://getbootstrap.com/docs/3.4/">Import from URL</a>
        <a class="dropdown-item" href="https://getbootstrap.com/docs/3.3/">Automated QA Imports</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item" href="/docs/versions/">Provenance Note</a>
      </div>
    </li>
    <li class="nav-item">
      <a class="nav-link text-light" href="#" onclick="javascript:$.ui.fancytree.getTree('#domain-grid-container').expandAll(false);">Apply</a>
    </li>
  </ul>

  <input class="btn btn-tool bg-light" type="search" name="search" placeholder="Filter" aria-label="search" autocomplete="off">
</header>

<main class="bd-content" name="content" role="main">
  <div class="content-page" id="page-networkmap">
     <!-- <div class="customer-page"> -->
       <div class="row">
        <div id="col-left" class="col-xl-10 none-margin-padding" style="width: calc(100% - 8px); padding-right: 8px; background: white;">
            <div id="network-map-canvas"></div>
        </div>
        <div id="col-right" class="col-xl-2 none-margin-padding" style="margin-left: -8px; height: 94.5vh;">            
          <div class="fancytree-grid-container flexbox-item-grow">
              <table id="domain-tree">
                  <colgroup>
                      <col width="50px">                       
                      <col width="*">
                      <col width="80px">
                      <col width="80px">
                      <col width="80px">
                      <col width="80px">
                  </colgroup>
                  <thead>
                  <tr>
                      <th>Action</th>
                      <th>Title</th>
                      <th>Tot. URLs</th>
                      <th>Tot. Success</th>
                      <th>Tot. Failed</th>
                      <th>Tot. Size</th>
                  </tr>
                  </thead>
              </table>
              <div id="verticalScrollbar" style="top:19px; height:calc(100% - 25px);"></div>
          </div>
        </div>
    </div>
  </div>

  <div class="content-page" id="page-urls">
    <div id="urls-grid-container" style="overflow: hidden;" class="ag-theme-balham"> </div>
  </div>

  <div class="content-page" id="page-hoppath">
    <div id="hoppath-canvas"></div>
  </div>

  <div class="content-page" id="page-hierachy">
    <div class="fancytree-grid-container flexbox-item-grow">
        <table id="hierachy-tree" class="mdl-data-table mdl-js-data-table mdl-shadow--2dp">
            <colgroup>
              <col style="width: 40px;">
              <col style="width: 1400px;">
              <col style="width: 200px;">
              <col style="width: 100px;">
              <col style="width: 100px;">
              <col style="width: 100px;">
              <col style="width: 100px;">
              <col style="width: 100px;">
              <col style="width: 100px;">
            </colgroup>
            <thead>
            <tr>
                <th class="mdl-data-table__cell--non-numeric"></th>
                <th class="mdl-data-table__cell--non-numeric">URL</th>
                <th>ContentType</th>
                <th>StatusCode</th>
                <th>Size</th>
                <th>URLs</th>
                <th>Success</th>
                <th>Failed</th>
                <th>TolSize</th>
            </tr>
            </thead>
        </table>
    </div>
  </div>
</main>

<script src="../dist/jquery/jquery-3.4.1.min.js"></script>
<script src="../dist/bootstrap/bootstrap.bundle.min.js"></script>
<!-- <script src="../dist/adminlte/js/adminlte.js"></script> -->
<script src="../dist/vis/vis-network.js"></script>
<script src="../dist/fancytree/jquery.fancytree-all-deps.min.js"></script>
<script src="../dist/fancytree/modules/jquery.fancytree.grid.js"></script>
<script src="../dist/fancytree/modules/jquery.fancytree.filter.js"></script>
<script src="../dist/fancytree/modules/plain-scrollbar.js"></script>
<script src="../dist/fancytree/modules/jquery.fancytree.logger.js"></script>
<!-- <script src="../dist/chartjs/Chart.js"></script> -->
<!-- <script src="../dist/jquery/menu/jquery.contextMenu.js"></script> -->
<script src="../dist/ag-grid/ag-grid-community.js"></script>
<script src="networkmap.js"></script>
<script src="qa.js"></script>

<script>
    var urlParameters=getUrlVars();
    var jobId=parseInt(urlParameters["targetInstanceOid"]);
    var harvestResultNumber=parseInt(urlParameters["harvestNumber"]);

    var visHopPath, visDomainMap;

    $(function(){
        sp("networkmap");
        var networkMapContainer = document.getElementById('network-map-canvas');
        var vis_networkmap;

        var sourceUrlDomains="/curator/networkmap/get/common?job=" + jobId + "&harvestResultNumber=" + harvestResultNumber + "&key=keyGroupByDomain";
        fetch(sourceUrlDomains)
            .then((response) => {
                console.log(response.status); // Will show you the status
                return response.json();
            })
            .then((data) => {
                // var data=formatStringArrayToJsonArray(rawData);
                // visDomainMap = drawNetworkMap(networkMapContainer, data.children);

                visDomainMap=new NetworkMap(networkMapContainer);
                visDomainMap.draw(data.children);
                // drawNetworkDomainGrid("#domain-tree", data);
        });


        $("input[name=search]").on("change search", function(e){
          var n,
            tree = $.ui.fancytree.getTree(),
            match = $.trim($(this).val());

          // Pass a string to perform case insensitive matching
          n = tree.filterNodes(match, { mode: "hide" });
          $("span.matches").text(n ? "(" + n + " matches)" : "");
        });

        $(".main-nav-link").click(function(event){
          var id=$(this).attr('id');
          sp(id);
        });

        initNetworkUrlGrid("#urls-grid-container");

        var sourceUrlRootUrls="/curator/networkmap/get/root/urls?job=" + jobId + "&harvestResultNumber=" + harvestResultNumber;
        fetch(sourceUrlRootUrls).then((response) => {
            if(response.status==200){
              if (response.redirected) {
                alert("Please login!")
                return null;
              }else{
                return response.json();
              }
            }
        }).then((data)=>{
          if(data!=null){
            drawNetworkTree("#hierachy-tree", data);
          }
        });
    });

</script>
</body>